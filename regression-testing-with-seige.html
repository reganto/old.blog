<!DOCTYPE html>
<html lang="fa">
<head>
  	<title>تست رگرسیون با Siege</title>

	<link rel="stylesheet" href="/theme/css/bootstrap.css" type="text/css" />
	<link rel="stylesheet" href="/theme/css/bootstrap-rtl.css" type="text/css" />
	<link rel="stylesheet" href="/theme/css/pygments.css" type="text/css" />
	<link rel="stylesheet" href="/theme/css/main.css" type="text/css" />
	<link rel="stylesheet" href="/theme/css/Vazir.css" type="text/css" />
	<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.min.js"></script>
	<script>
  		$(document).ready(function () {
    		$(".post table").addClass("table table-striped table-condensed table-bordered");
  	  	});
    </script>
	<meta charset="utf-8" />

	<link rel="alternate" href="/feeds/all.atom.xml" type="application/atom+xml" title="خبرخوان رگانتو -دست و دل نوشته‌های گیکی از وانیار " />


    <meta name="tags" content="test" />
    <meta name="tags" content="regression testing" />
</head>
<body>
	<div class="wrap">
		<div class="container">
			<div class="banner">
				<a href="">رگانتو</a>
				<h1>دست و دل نوشته‌های گیکی از وانیار</h1>
			</div>
<div class="content">
	<div class="post">
		<h3>
			تست رگرسیون با Siege
		</h3>
		<div class="info">
			Wed 18 May 2022
				توسط <a class="url fn" href="/author/reganto.html">Reganto</a>
		</div>
		<div class="content">
			<p>فرض کنید می‌خواهید برنامه ی تحت وب خود را برای یک میلیون کاربر آماده کنید.برای تست این برنامه دو راه وجود دارد، راه اول این است که از یک میلیون کاربر بخواهید که برنامه ی شما را تست کنند و راه دوم شبیه سازی این تعداد کاربر است.</p>
<h3>انواع تست کارایی</h3>
<p><strong>Load test:</strong>
وقتی که برنامه تحت وب را برای تعداد مشخص و از قبل تعیین شده‌ای از درخواست ها تست می‌کنیم،‌به این نوع تست load test می گویند.</p>
<p><strong>Stress test:</strong>
اگر تعداد درخواست از سطح مشخص شده فراتر رود در این صورت تست را stress test می گویند.</p>
<p><strong>Regression test:</strong>
وقتی تغییری در نرم‌افزار داده می شود،چگونه بفهمیم کارایی نرم‌افزار کاهش نیافته است؟ برای حصول اطمینان از یکسان بودن کارایی سرور قبل و بعد از تغییر، ‌regression test انجام می شود. اگر بخواهیم زیرساخت ها ی پروژه را تغییر دهیم دوباره به regression test نیاز خواهیم داشت. فرض کنید پروژه بر روی وب سرور Apache باشد و بخواهیم وب سرور را به Nginx تغییر دهیم. قبل از تغییر وب سرور ‌برنامه به صورت میانگین قادر به مدیریت N در خواست در دقیقه است. از کجا معلوم که با تغییر وب سرور کارایی برنامه کاهش نیابد و همچنان N درخواست در دقیقه قابل مدیریت باشد؟</p>
<h3>مراحل انجام یک تست موفق:</h3>
<p><strong>برنامه ریزی:</strong>
در این مرحله باید به سؤالاتی از این قبیل پاسخ داده شود: چه چیزی باید تست شود؟ چه انتظاری از تست وجود دارد؟ ترافیک روی سرور چقدر باید باشد؟ تست بر روی کدام آدرس باید انجام شود؟ و . . .</p>
<p><strong>آماده سازی:</strong>
در این مرحله باید از ایزوله بودن محیط تست اطمینان حاصل شود. برای انجام تست های بعدی هم از همین محیط ایزوله استفاده می‌شود.</p>
<p><strong>آنالیز:</strong>
نتایج حاصل از تست باید مورد ارزیابی دقیق قرار گیرند.</p>
<h3>شروع کار با Siege:</h3>
<p>ابزاری فوق‌العاده برای بنچمارک گیری و تست اپلیکیشن های تحت وب است. این ابزار کاربران همزمان را برای تست اپ های تحت وب شبیه سازی می کند.</p>
<p><strong>نصب:</strong>
در توزیع ابونتو ابزار siege بدین صورت نصب می شود:«البته با نصب از طریق مخازن اصلی ابونتو، جدیدترین ورژن نصب نخواهد شد»</p>
<div class="highlight"><pre><span></span><code>sudo apt-get install siege
</code></pre></div>

<p><strong>ایجاد سرور آزمایشی:</strong>
برای ایجاد یک سرور آزمایشی تنها کافی است کد زیر را تایپ کنید:</p>
<div class="highlight"><pre><span></span><code>python -m http.server PORT
</code></pre></div>

<p>به جای PORT باید پورت مورد نظر خود برای اجرای سرور را وارد کنید.</p>
<p><strong>اصول اولیه کار با siege:</strong></p>
<p>برای شروع کار دستورات زیر را در شل اجرا کنید:</p>
<div class="highlight"><pre><span></span><code>siege URL
</code></pre></div>

<p>به جای URL باید آدرس مورد نظر جایگزین شود. در این صورت تست با پارامتر های پیش‌فرض انجام می شود. برای اتمام تست از کلید های ترکیبی CTRL+C استفاده کنید.</p>
<p><strong>اولین تست:</strong></p>
<p>فرض کنید سرور را بر روی پورت 8888 اجرا کرده‌ایم. حال با استفاده از siege سرور را تست می‌کنیم.</p>
<div class="highlight"><pre><span></span><code>siege -c <span class="m">1</span> -r <span class="m">1</span> http://localhost:8888/
</code></pre></div>

<p>خروجی به صورت زیر است:</p>
<div class="highlight"><pre><span></span><code>** SIEGE <span class="m">4</span>.0.4
** Preparing <span class="m">1</span> concurrent users <span class="k">for</span> battle.
The server is now under siege...
Transactions:                      <span class="m">1</span> hits
Availability:                 <span class="m">100</span>.00 %
Elapsed time:                   <span class="m">0</span>.00 secs
Data transferred:               <span class="m">0</span>.00 MB
Response time:                  <span class="m">0</span>.00 secs
Transaction rate:               <span class="m">0</span>.00 trans/sec
Throughput:                     <span class="m">0</span>.00 MB/sec
Concurrency:                    <span class="m">0</span>.00
Successful transactions:           <span class="m">1</span>
Failed transactions:               <span class="m">0</span>
Longest transaction:            <span class="m">0</span>.00
Shortest transaction:           <span class="m">0</span>.00
</code></pre></div>

<p>آرگومان <code>r-</code> تعداد تکرار تست را تعیین می‌کند. آرگومان <code>c-</code> تعداد کاربران شبیه‌سازی شده را مشخص می‌کند. پس تعداد درخواست‌های فرستاده شده به سمت سرور برابر ضرب مقدار این دو آرگومان خواهد شد.</p>
<p><strong>تحلیل خروجی تست:</strong></p>
<p><strong>Transaction:</strong>
برای هر کلاینت از طرف سرور یک سوکت باز می شود،‌ درخواست مدیریت می شود،‌ پاسخ برگشت داده می‌شود و درنهایت سوکت بسته می شود. این ها کارهایی است که در یک تراکنش انجام می شود. این مورد تعداد درخواست‌های فرستاده شده به سمت سرور را مشخص می‌کند.</p>
<p><strong>Availability:</strong>
درصد درخواست‌هایی است که با موفقیت توسط سرور مدیریت شده اند.</p>
<p><strong>Elapsed time:</strong>
زمان انجام تست است.</p>
<p><strong>Data transferred:</strong>
مجموع داده‌هایی است که از طرف سرور به هر کاربر شبیه سازی شده ارسال شده است.</p>
<p><strong>Response time:</strong>
میانگین زمانی برای پاسخ به درخواست یک کاربر شبیه سازی شده است.</p>
<p><strong>Transaction rate:</strong>
میانگین تعداد تراکنش هایی است که سرور می‌تواند در یک ثانیه مدیریت کند(Transaction / Elapsed time)</p>
<p><strong>Throughput:</strong>
میانگین تعداد بایت هایی است که در هر ثانیه از سرور به تمام کاربران شبیه سازی شده انتقال می یابد.</p>
<p><strong>Concurrency:</strong>
حاصل تقسیم تعداد کل تراکنش ها به زمان کل سپری شده است(Transaction/ Elapsed time ).هر چه این عدد بزرگ‌تر باشد،‌کارایی سرور کم‌تر است.</p>
<p><strong>Successful transactions:</strong>
تعداد دفعاتی که کد پاسخ(response code)برگشت داده شده از طرف سرور کوچک تر از 400 است.(تراکنش با موفقیت انجام شده باشد)</p>
<p><strong>Failed transactions:</strong>
تعداد دفعاتی که کد پاسخ برگشت داده شده از طرف سرور بزرگ‌تر یا مساوی 400 باشد به علاوه تراکنش هایی که اصطلاحاً timeout می شوند.</p>
<p><strong>Longest transaction:</strong>
بیشترین زمانی که یک تراکنش طول کشیده است.</p>
<p><strong>Shortest transaction:</strong>
کم‌ترین زمانی که یک تراکنش طول کشیده است.</p>
<p><strong>سوئیچ‌های siege</strong></p>
<p>در این قسمت سوئیچ های ابزار siege را مورد بررسی قرار خواهیم داد. با سوئیچ h- هلپ ابزار نمایش داده می شود.</p>
<div class="highlight"><pre><span></span><code>siege -h
</code></pre></div>

<p>خروجی به صورت زیر خواهد بود:</p>
<div class="highlight"><pre><span></span><code>Usage: siege <span class="o">[</span>options<span class="o">]</span>
       siege <span class="o">[</span>options<span class="o">]</span> URL
       siege -g URL
Options:
  -V, --version             VERSION, prints the version number.
  -h, --help                HELP, prints this section.
  -C, --config              CONFIGURATION, show the current config.
  -v, --verbose             VERBOSE, prints notification to screen.
  -q, --quiet               QUIET turns verbose off and suppresses output.
  -g, --get                 GET, pull down HTTP headers and display the
                            transaction. Great <span class="k">for</span> application debugging.
  -p, --print               PRINT, like GET only it prints the entire page.
  -c, --concurrent<span class="o">=</span>NUM      CONCURRENT users, default is <span class="m">10</span>
  -r, --reps<span class="o">=</span>NUM            REPS, number of <span class="nb">times</span> to run the test.
  -t, --time<span class="o">=</span>NUMm           TIMED testing where <span class="s2">&quot;m&quot;</span> is modifier S, M, or H
                            ex: --time<span class="o">=</span>1H, one hour test.
  -d, --delay<span class="o">=</span>NUM           Time DELAY, random delay before each requst
  -b, --benchmark           BENCHMARK: no delays between requests.
  -i, --internet            INTERNET user simulation, hits URLs randomly.
  -f, --file<span class="o">=</span>FILE           FILE, <span class="k">select</span> a specific URLS FILE.
  -R, --rc<span class="o">=</span>FILE             RC, specify an siegerc file
  -l, --log<span class="o">[=</span>FILE<span class="o">]</span>          LOG to FILE. If FILE is not specified, the
                            default is used: /var/log/siege.log
  -m, --mark<span class="o">=</span><span class="s2">&quot;text&quot;</span>         MARK, mark the log file with a string.
                            between .001 and NUM. <span class="o">(</span>NOT COUNTED IN STATS<span class="o">)</span>
  -H, --header<span class="o">=</span><span class="s2">&quot;text&quot;</span>       Add a header to request <span class="o">(</span>can be many<span class="o">)</span>
  -A, --user-agent<span class="o">=</span><span class="s2">&quot;text&quot;</span>   Sets User-Agent <span class="k">in</span> request
  -T, --content-type<span class="o">=</span><span class="s2">&quot;text&quot;</span> Sets Content-Type <span class="k">in</span> request
      --no-parser           NO PARSER, turn off the HTML page parser
      --no-follow           NO FOLLOW, <span class="k">do</span> not follow HTTP redirects

Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2017</span> by Jeffrey Fulmer, et al.
This is free software<span class="p">;</span> see the <span class="nb">source</span> <span class="k">for</span> copying conditions.
There is NO warranty<span class="p">;</span> not even <span class="k">for</span> MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.
</code></pre></div>

<p>اولین سوئیچ V- است. اگر ابزار با این سوئیچ اجرا شود،‌ ورژن ابزار و کپی رایت مربوط به آن نمایش داده می شود. </p>
<div class="highlight"><pre><span></span><code>siege -V
</code></pre></div>

<p>خروجی به صورت زیر خواهد بود:</p>
<div class="highlight"><pre><span></span><code>SIEGE <span class="m">4</span>.0.4

Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2017</span> by Jeffrey Fulmer, et al.
This is free software<span class="p">;</span> see the <span class="nb">source</span> <span class="k">for</span> copying conditions.
There is NO warranty<span class="p">;</span> not even <span class="k">for</span> MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.
</code></pre></div>

<p>سوئیچ بعدی C- است. این سوئیچ تنظیماتی را که ابزار با آن اجرا می شود را نمایش می دهد.</p>
<div class="highlight"><pre><span></span><code>siege -C
</code></pre></div>

<p>خروجی به صورت زیر خواهد بود:</p>
<div class="highlight"><pre><span></span><code>CURRENT  SIEGE  CONFIGURATION
Mozilla/5.0 <span class="o">(</span>pc-x86_64-linux-gnu<span class="o">)</span> Siege/4.0.4
Edit the resource file to change the settings.
----------------------------------------------
version:                        <span class="m">4</span>.0.4
verbose:                        <span class="nb">false</span>
color:                          <span class="nb">true</span>
quiet:                          <span class="nb">false</span>
debug:                          <span class="nb">false</span>
protocol:                       HTTP/1.1
HTML parser:                    enabled
get method:                     HEAD
connection:                     close
concurrent users:               <span class="m">25</span>
<span class="nb">time</span> to run:                    n/a
repetitions:                    n/a
socket timeout:                 <span class="m">30</span>
cache enabled:                  <span class="nb">false</span>
accept-encoding:                gzip, deflate
delay:                          <span class="m">0</span>.000 sec
internet simulation:            <span class="nb">false</span>
benchmark mode:                 <span class="nb">false</span>
failures <span class="k">until</span> abort:           <span class="m">1024</span>
named URL:                      none
URLs file:                      /etc/siege/urls.txt
thread limit:                   <span class="m">255</span>
logging:                        <span class="nb">false</span>
log file:                       /var/log/log/siege.log
resource file:                  /home/reganto/.siege/siege.conf
timestamped output:             <span class="nb">false</span>
comma separated output:         <span class="nb">false</span>
allow redirects:                <span class="nb">true</span>
allow zero byte data:           <span class="nb">true</span>
allow chunked encoding:         <span class="nb">true</span>
upload unique files:            <span class="nb">true</span>
no-follow:
 - ad.doubleclick.net
 - pagead2.googlesyndication.com
 - ads.pubsqrd.com
 - ib.adnxs.com
</code></pre></div>

<p>سوئیچ بعدی v- است. اگر ابزار با این سوئیچ اجرا شود،‌ابزار اصطلاحا verbose خواهد بود. دراین حالت تمام اکشن هایی که توسط ابزار انجام می شود،‌در صفحه نمایش نشان داده می شود. تست سوئیچ v- را با یک کاربر شبیه سازی شده و به مدت ۵ ثانیه بر روی گوگل انجام می دهیم .</p>
<div class="highlight"><pre><span></span><code>siege -c <span class="m">1</span> -t 5S -v https://google.com/
</code></pre></div>

<p>با آرگومان t- می‌توان زمان انجام تست را تعیین کرد. (S برای ثانیه، M برای دقیقه , H برای ساعت)</p>
<blockquote>
<p>حتما متوجه شده‌اید که از این ابزار برای حملات <a href="https://en.wikipedia.org/wiki/Denial-of-service_attack">DOS</a> نیز می‌توان استفاده کرد پس زمان تست را افزایش ندهید.</p>
</blockquote>
<p>خروجی:</p>
<div class="highlight"><pre><span></span><code>** SIEGE <span class="m">4</span>.0.4                                                     
** Preparing <span class="m">1</span> concurrent users <span class="k">for</span> battle.
The server is now under siege...
HTTP/1.1 <span class="m">301</span>     <span class="m">1</span>.26 secs:     <span class="m">220</span> <span class="nv">bytes</span> <span class="o">==</span>&gt; GET  /
HTTP/1.1 <span class="m">200</span>     <span class="m">1</span>.11 secs:   <span class="m">16557</span> <span class="nv">bytes</span> <span class="o">==</span>&gt; GET  /
HTTP/1.1 <span class="m">200</span>     <span class="m">0</span>.65 secs:    <span class="m">5482</span> <span class="nv">bytes</span> <span class="o">==</span>&gt; GET  /images/branding/googlelogo/1x/googlelogo_white_background_color_272x92dp.png
HTTP/1.1 <span class="m">301</span>     <span class="m">0</span>.88 secs:     <span class="m">220</span> <span class="nv">bytes</span> <span class="o">==</span>&gt; GET  /

Lifting the server siege...
Transactions:                      <span class="m">3</span> hits
Availability:                 <span class="m">100</span>.00 %
Elapsed time:                   <span class="m">4</span>.64 secs
Data transferred:               <span class="m">0</span>.02 MB
Response time:                  <span class="m">1</span>.30 secs
Transaction rate:               <span class="m">0</span>.65 trans/sec
Throughput:                     <span class="m">0</span>.00 MB/sec
Concurrency:                    <span class="m">0</span>.84
Successful transactions:           <span class="m">4</span>
Failed transactions:               <span class="m">0</span>
Longest transaction:            <span class="m">1</span>.26
Shortest transaction:           <span class="m">0</span>.65
</code></pre></div>

<p>همانطور که می‌بینید خروجی به صورت verbose نمایش داده شده است.</p>
<p>سوئیچ بعدی q- است. این سوئیچ مخالف سوئیچ قبلی است. اگر تست با این سوئیچ انجام شود،‌هیچگونه خروجی ای در صفحه نمایش ظاهر نمی شود(پیام اتمام فرایند تست در خروجی نمایش داده می شود)</p>
<div class="highlight"><pre><span></span><code>siege -c <span class="m">1</span> -t 5S -q https://google.com/
</code></pre></div>

<p>خروجی به صورت زیر خواهد بود:</p>
<div class="highlight"><pre><span></span><code>Lifting the server siege...
</code></pre></div>

<p>سوئیچ بعدی g- است. اگر تست با این سوئیچ اجرا شود،‌ Request Headers و Response Headers  به همراه خروجی تست نمایش داده می شوند.</p>
<div class="highlight"><pre><span></span><code>siege -c <span class="m">1</span> -r <span class="m">1</span> -g https://google.com/
</code></pre></div>

<p>خروجی به صورت زیر خواهد بود:</p>
<div class="highlight"><pre><span></span><code>HEAD / HTTP/1.0
Host: google.com
Accept: */*
Accept-Encoding: gzip, deflate
User-Agent: Mozilla/5.0 <span class="o">(</span>pc-x86_64-linux-gnu<span class="o">)</span> Siege/4.0.4
Connection: close


HTTP/1.0 <span class="m">301</span> Moved Permanently
Location: https://www.google.com/
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8
Date: Wed, <span class="m">18</span> May <span class="m">2022</span> <span class="m">13</span>:58:15 GMT
Expires: Fri, <span class="m">17</span> Jun <span class="m">2022</span> <span class="m">13</span>:58:15 GMT
Cache-Control: public, max-age<span class="o">=</span><span class="m">2592000</span>
Server: gws
Content-Length: <span class="m">220</span>
X-XSS-Protection: <span class="m">0</span>
X-Frame-Options: SAMEORIGIN
Alt-Svc: <span class="nv">h3</span><span class="o">=</span><span class="s2">&quot;:443&quot;</span><span class="p">;</span> <span class="nv">ma</span><span class="o">=</span><span class="m">2592000</span>,h3-29<span class="o">=</span><span class="s2">&quot;:443&quot;</span><span class="p">;</span> <span class="nv">ma</span><span class="o">=</span><span class="m">2592000</span>,h3-Q050<span class="o">=</span><span class="s2">&quot;:443&quot;</span><span class="p">;</span> <span class="nv">ma</span><span class="o">=</span><span class="m">2592000</span>,h3-Q046<span class="o">=</span><span class="s2">&quot;:443&quot;</span><span class="p">;</span> <span class="nv">ma</span><span class="o">=</span><span class="m">2592000</span>,h3-Q043<span class="o">=</span><span class="s2">&quot;:443&quot;</span><span class="p">;</span> <span class="nv">ma</span><span class="o">=</span><span class="m">2592000</span>,quic<span class="o">=</span><span class="s2">&quot;:443&quot;</span><span class="p">;</span> <span class="nv">ma</span><span class="o">=</span><span class="m">2592000</span><span class="p">;</span> <span class="nv">v</span><span class="o">=</span><span class="s2">&quot;46,43&quot;</span>


GET / HTTP/1.0
Host: www.google.com
Accept: */*
Accept-Encoding: gzip, deflate
User-Agent: Mozilla/5.0 <span class="o">(</span>pc-x86_64-linux-gnu<span class="o">)</span> Siege/4.0.4
Connection: close


HTTP/1.0 <span class="m">200</span> OK
Date: Wed, <span class="m">18</span> May <span class="m">2022</span> <span class="m">13</span>:58:15 GMT
Expires: -1
Cache-Control: private, max-age<span class="o">=</span><span class="m">0</span>
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8
P3P: <span class="nv">CP</span><span class="o">=</span><span class="s2">&quot;This is not a P3P policy! See g.co/p3phelp for more info.&quot;</span>
Content-Encoding: gzip
Server: gws
Content-Length: <span class="m">16549</span>
X-XSS-Protection: <span class="m">0</span>
X-Frame-Options: SAMEORIGIN
Set-Cookie: <span class="nv">1P_JAR</span><span class="o">=</span><span class="m">2022</span>-05-18-13<span class="p">;</span> <span class="nv">expires</span><span class="o">=</span>Fri, <span class="m">17</span>-Jun-2022 <span class="m">13</span>:58:15 GMT<span class="p">;</span> <span class="nv">path</span><span class="o">=</span>/<span class="p">;</span> <span class="nv">domain</span><span class="o">=</span>.google.com<span class="p">;</span> Secure
Set-Cookie: <span class="nv">AEC</span><span class="o">=</span>AakniGMdinGLKkNMlyftRpRAM4cMUqgUrRD_RwKDoO-zjrnh86-IVfvrZQ<span class="p">;</span> <span class="nv">expires</span><span class="o">=</span>Mon, <span class="m">14</span>-Nov-2022 <span class="m">13</span>:58:15 GMT<span class="p">;</span> <span class="nv">path</span><span class="o">=</span>/<span class="p">;</span> <span class="nv">domain</span><span class="o">=</span>.google.com<span class="p">;</span> Secure<span class="p">;</span> HttpOnly<span class="p">;</span> <span class="nv">SameSite</span><span class="o">=</span>lax
Set-Cookie: <span class="nv">NID</span><span class="o">=</span><span class="nv">511</span><span class="o">=</span>iOqxShyPFsdByVNu1VRRvSkoaMtVo7rmFosEnMXXiNjV0csTcZMZasN5Ci61UHRngT75Id5lhl_XAwahXXfn9vaSnFExBF9WQDdd6V7u5jFL8uMPdjwdc4ztHk8PdERarunLE4kMNzc5ZprheXKLpTHw0xk_l8HGhmi86Exur8s<span class="p">;</span> <span class="nv">expires</span><span class="o">=</span>Thu, <span class="m">17</span>-Nov-2022 <span class="m">13</span>:58:15 GMT<span class="p">;</span> <span class="nv">path</span><span class="o">=</span>/<span class="p">;</span> <span class="nv">domain</span><span class="o">=</span>.google.com<span class="p">;</span> HttpOnly
Alt-Svc: <span class="nv">h3</span><span class="o">=</span><span class="s2">&quot;:443&quot;</span><span class="p">;</span> <span class="nv">ma</span><span class="o">=</span><span class="m">2592000</span>,h3-29<span class="o">=</span><span class="s2">&quot;:443&quot;</span><span class="p">;</span> <span class="nv">ma</span><span class="o">=</span><span class="m">2592000</span>,h3-Q050<span class="o">=</span><span class="s2">&quot;:443&quot;</span><span class="p">;</span> <span class="nv">ma</span><span class="o">=</span><span class="m">2592000</span>,h3-Q046<span class="o">=</span><span class="s2">&quot;:443&quot;</span><span class="p">;</span> <span class="nv">ma</span><span class="o">=</span><span class="m">2592000</span>,h3-Q043<span class="o">=</span><span class="s2">&quot;:443&quot;</span><span class="p">;</span> <span class="nv">ma</span><span class="o">=</span><span class="m">2592000</span>,quic<span class="o">=</span><span class="s2">&quot;:443&quot;</span><span class="p">;</span> <span class="nv">ma</span><span class="o">=</span><span class="m">2592000</span><span class="p">;</span> <span class="nv">v</span><span class="o">=</span><span class="s2">&quot;46,43&quot;</span>


GET /images/branding/googlelogo/1x/googlelogo_white_background_color_272x92dp.png HTTP/1.0
Host: www.google.com
Cookie: <span class="nv">1P_JAR</span><span class="o">=</span><span class="m">2022</span>-05-18-13<span class="p">;</span><span class="nv">AEC</span><span class="o">=</span>AakniGMdinGLKkNMlyftRpRAM4cMUqgUrRD_RwKDoO-zjrnh86-IVfvrZQ<span class="p">;</span><span class="nv">NID</span><span class="o">=</span><span class="nv">511</span><span class="o">=</span>iOqxShyPFsdByVNu1VRRvSkoaMtVo7rmFosEnMXXiNjV0csTcZMZasN5Ci61UHRngT75Id5lhl_XAwahXXfn9vaSnFExBF9WQDdd6V7u5jFL8uMPdjwdc4ztHk8PdERarunLE4kMNzc5ZprheXKLpTHw0xk_l8HGhmi86Exur8s
Accept: */*
Accept-Encoding: gzip, deflate
User-Agent: Mozilla/5.0 <span class="o">(</span>pc-x86_64-linux-gnu<span class="o">)</span> Siege/4.0.4
Connection: close


HTTP/1.0 <span class="m">200</span> OK
Accept-Ranges: bytes
Content-Type: image/png
Cross-Origin-Resource-Policy: cross-origin
Cross-Origin-Opener-Policy-Report-Only: same-origin<span class="p">;</span> report-to<span class="o">=</span><span class="s2">&quot;static-on-bigtable&quot;</span>
Report-To: <span class="o">{</span><span class="s2">&quot;group&quot;</span>:<span class="s2">&quot;static-on-bigtable&quot;</span>,<span class="s2">&quot;max_age&quot;</span>:2592000,<span class="s2">&quot;endpoints&quot;</span>:<span class="o">[{</span><span class="s2">&quot;url&quot;</span>:<span class="s2">&quot;https://csp.withgoogle.com/csp/report-to/static-on-bigtable&quot;</span><span class="o">}]}</span>
Content-Length: <span class="m">5482</span>
Date: Wed, <span class="m">18</span> May <span class="m">2022</span> <span class="m">13</span>:58:16 GMT
Expires: Wed, <span class="m">18</span> May <span class="m">2022</span> <span class="m">13</span>:58:16 GMT
Cache-Control: private, max-age<span class="o">=</span><span class="m">31536000</span>
Last-Modified: Tue, <span class="m">22</span> Oct <span class="m">2019</span> <span class="m">18</span>:30:00 GMT
X-Content-Type-Options: nosniff
Server: sffe
X-XSS-Protection: <span class="m">0</span>
Alt-Svc: <span class="nv">h3</span><span class="o">=</span><span class="s2">&quot;:443&quot;</span><span class="p">;</span> <span class="nv">ma</span><span class="o">=</span><span class="m">2592000</span>,h3-29<span class="o">=</span><span class="s2">&quot;:443&quot;</span><span class="p">;</span> <span class="nv">ma</span><span class="o">=</span><span class="m">2592000</span>,h3-Q050<span class="o">=</span><span class="s2">&quot;:443&quot;</span><span class="p">;</span> <span class="nv">ma</span><span class="o">=</span><span class="m">2592000</span>,h3-Q046<span class="o">=</span><span class="s2">&quot;:443&quot;</span><span class="p">;</span> <span class="nv">ma</span><span class="o">=</span><span class="m">2592000</span>,h3-Q043<span class="o">=</span><span class="s2">&quot;:443&quot;</span><span class="p">;</span> <span class="nv">ma</span><span class="o">=</span><span class="m">2592000</span>,quic<span class="o">=</span><span class="s2">&quot;:443&quot;</span><span class="p">;</span> <span class="nv">ma</span><span class="o">=</span><span class="m">2592000</span><span class="p">;</span> <span class="nv">v</span><span class="o">=</span><span class="s2">&quot;46,43&quot;</span>

Transactions:                      <span class="m">3</span> hits
Availability:                 <span class="m">100</span>.00 %
Elapsed time:                   <span class="m">3</span>.83 secs
Data transferred:               <span class="m">0</span>.02 MB
Response time:                  <span class="m">1</span>.28 secs
Transaction rate:               <span class="m">0</span>.78 trans/sec
Throughput:                     <span class="m">0</span>.01 MB/sec
Concurrency:                    <span class="m">1</span>.00
Successful transactions:           <span class="m">3</span>
Failed transactions:               <span class="m">0</span>
Longest transaction:            <span class="m">2</span>.37
Shortest transaction:           <span class="m">0</span>.70
</code></pre></div>

<p>همانطور که می‌بینید هدر‌های درخواست‌ها و پاسخ‌ها نیز در خروجی تست وجود دارند.</p>
<p>سوئیچ بعدی p- است. این سوئیچ همان کار سوئیچ قبلی را انجام می دهد و علاوه بر آن محتوای html ی صفحه را نیز بر میگرداند.</p>
<div class="highlight"><pre><span></span><code>siege -p -v https://google.com/
</code></pre></div>

<p>سوئیچ c- تعداد کاربران شبیه سازی شده را تعیین می کند. siege به صورت پیشفرض ۱۰ کاربر شبیه‌سازی شده را برای تست فراهم می‌کند.</p>
<p>مثال: تست با سه کاربر شبیه‌سازی شده:</p>
<div class="highlight"><pre><span></span><code>siege -c <span class="m">3</span> -v https://google.com/
</code></pre></div>

<p>سوئیچ r- نشان‌دهنده تعداد تکرار درخواست‌های ارسالی است.</p>
<p>مثال: تست با یک کاربر شبیه‌سازی شده و با تعداد تکرار ۲:</p>
<div class="highlight"><pre><span></span><code>siege -c <span class="m">1</span> -r <span class="m">2</span> -v https://google.com/
</code></pre></div>

<p>سوئیچ بعدی t- ،‌ زمان انجام تست را مشخص می کند.</p>
<p>مثال: تست برای دو کاربر همزمان شبیه‌سازی شده و به مدت ۱۰ ثانیه:</p>
<div class="highlight"><pre><span></span><code>siege -c <span class="m">2</span> -t 10S -v https://google.com/
</code></pre></div>

<p>برای مشخص کردن زمان انجام تست از سه فلگ S برای ثانیه،‌ M برای دقیقه و H برای ساعت استفاده می‌شود.  </p>
<p>سوئیچ بعدی d-  است که برای ایجاد یک تاخیر رندوم بین درخواست ها استفاده می‌شود البته می توانیم میزان تاخیر بین درخواست ها را نیز تعیین کنیم.</p>
<p>مثال:این تست برای ۲ کاربر همزمان شبیه سازی شده اجرا می‌شود هر کاربر ۳ بار درخواست را تکرار می کند و بین درخواست ها تاخیر یک ثانیه ای وجود دارد.</p>
<div class="highlight"><pre><span></span><code>siege -c <span class="m">2</span> -r <span class="m">3</span> -d 1S -v https://google.com/
</code></pre></div>

<p>سوئیچ بعدی کاری مخالف سوئیچ تاخیر انجام می‌دهد. اگر ابزار با سوئیج b- اجرا شود،‌ هیچ تاخیری بین درخواست ها اتفاق نمی‌افتد و درخواست ها پشت سر هم به سرور ارسال می‌شوند. این سوئیچ برای بنچمارک گیری استفاده می‌شود.</p>
<p>مثال: این تست برای دوکاربر همزمان شبیه سازی شده و با تعداد تکرار پنج انجام می‌شود. درضمن تاخیری بین درخواست ها وجود ندارد.</p>
<div class="highlight"><pre><span></span><code>siege -c <span class="m">2</span> -r <span class="m">5</span> -b -v https://google.com/
</code></pre></div>

<p>سوئیچ بعدی i- که برای شبیه سازی یک کاربر معمولی استفاده می‌شود. هر کاربری که وارد یک سایت می‌شود با توجه به نیاز و علاقه مندی‌ خود ممکن است بر روی لینک های مختلفی کلیک کند. سوئیچ i- این رفتار کاربران را شبیه سازی می کند. پس وقتی که تست با این سوئیچ انجام شود، آدرس های مختلفی به صورت رندوم تست می شوند.</p>
<p>مثال: این تست برای دو کاربر همزمان و با تعداد تکرار یک و با شبیه سازی رفتار کاربران انجام می‌شود.</p>
<div class="highlight"><pre><span></span><code>‍siege -c <span class="m">2</span> -r <span class="m">1</span> -i -v https://google.com/
</code></pre></div>

<p>سوئیچ بعدی f- است. این سوئیچ برای تعیین مسیر فایلی که حاوی آدرس های مورد تست است، استفاده می‌شود. اگر فایلی با نام test.txt و محتوی دو آدرس به صورت زیر داشته باشیم،</p>
<div class="highlight"><pre><span></span><code><span class="nl">https:</span><span class="c1">//reganto.github.com/</span>
<span class="nl">https:</span><span class="c1">//google.com/</span>
</code></pre></div>

<p>در آن صورت تست به صورت زیر انجام می‌شود.</p>
<div class="highlight"><pre><span></span><code>siege -c <span class="m">2</span> -t 10S -v -f test.txt
</code></pre></div>

<p>تست برای دوکاربر شبیه سازی شده و در طی ۱۰ ثانیه بر روی دو آدرس موجود در فایل انجام می‌شود.
سوئیچ بعدی R- است. این سوئیچ برای معرفی یک siegerc فایل به ابزار استفاده می‌شود. اینگونه فایل ها دقیقا مشابه فایل bashrc هستند و با اجرای ابزار،‌ تنظیماتی را بر روی آن ابزار اعمال می کند. فایل siegerc پیش فرض در مسیر etc/siege/siegerc/ قرار دارد. می تونید این فایل را با یک ادیتور باز کنید و تنظیمات را تغییر دهید.(راهنمای هر دستور به صورت کامنت شده در فایل siegerc وجود دارد.)
سوئیچ بعدی l- است. این سوئیچ برای معرفی یک لاگ فایل به ابزار استفاده می‌شود تا ابزار لاگ‌های خود را در آن ثبت کند. اگر فایلی تعیین نشود،‌ لاگ ها به طور پیش فرش در var/log/siege.log/قرار می گیرند. برای معرفی یک لاگ فایل از آپشن لانگ یعنی log-- نیز می‌توان استفاده کرد. به مثال زیر توجه کنید:</p>
<div class="highlight"><pre><span></span><code>siege -c <span class="m">2</span> -t 5S -v --log<span class="o">=</span>siege.log https://google.com/
</code></pre></div>

<p>تنظیمات کلی ابزار در مسیر  siege/siege.conf./~ قرار دارد.
سوئیچ بعدی m- و نوع لانگ آن mark-- است. این سوئیچ برای نشانه‌گذاری در لاگ فایل استفاده می‌شود و لاگ های مربوط به هر کاربر را با یک رشته از هم جدا می کند. شاید یک مثال به روشن شدن موضوع کمک کند. یک سرور آزمایشی ایجاد میکنم:</p>
<div class="highlight"><pre><span></span><code>python -m http.server <span class="m">8001</span> --bind<span class="o">=</span><span class="m">127</span>.0.0.1
</code></pre></div>

<p>البته می توانید تست را بر روی هر سرور دیگری نیز انجام دهید.</p>
<div class="highlight"><pre><span></span><code>siege -c <span class="m">2</span> -t 5S -v --log<span class="o">=</span>siege.log --mark<span class="o">=</span><span class="s2">&quot;aaaaa&quot;</span> http://localhost:8001/
</code></pre></div>

<p>بعد از انجام تست، لاگ فایل را باز کنید.</p>
<div class="highlight"><pre><span></span><code>Date &amp; Time,  Trans,  Elap Time,  Data Trans,  Resp Time,  Trans Rate,  Throughput,  Concurrent,    OKAY,   Failed
2022-05-21 00:11:32,      7,       2.78,           0,       0.40,        2.52,        0.00,        1.00,       7,       0
**** aaaaa ****
2022-05-21 00:35:48,   1352,       4.40,           3,       0.01,      307.27,        0.68,        1.97,    1352,       0
</code></pre></div>

<p>همانطور که می بینید لاگ های مربوط به تست های مربوط به کاربران شبیه‌سازی مختلف با aaaaa از هم جدا شده اند. پس سوئیچ mark-- نقش یک delimiter«حائل» رو برای لاگ های مربوط به کاربران شبیه‌سازی‌شده مختلف در لاگ فایل  ایفا می‌کند.</p>
<p>سوئیچ بعدی H- و لانگ آن یعنی header-- است. این سوئیچ برای اضافه کردن یک هدر به درخواست استفاده می‌شود.</p>
<div class="highlight"><pre><span></span><code>siege -c <span class="m">1</span> -t 5S -v --header<span class="o">=</span><span class="s2">&quot;cache-control: no-cache&quot;</span> http://localhost:8001/
</code></pre></div>

<p>لیستی از هدر‌های HTTP را می‌توانید <a href="https://en.wikipedia.org/wiki/List_of_HTTP_header_fields">اینجا</a> بیابید.
 با سوئیچ A- یا شکل لانگ آن user-agent-- می توان agent در خواست دهنده را مشخص کرد.  برای مشاهده‌ی لیستی از agentهای معروف می‌توانید به این <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent">لینک</a> مراجعه بفرمایید.</p>
<div class="highlight"><pre><span></span><code>siege -c <span class="m">1</span> -r <span class="m">1</span> -v -A<span class="o">=</span><span class="s2">&quot;curl/7.68.0&quot;</span> http://localhost:8001/
</code></pre></div>

<p>اگر agent تعیین نشود، Mozilla/5.0 (pc-x86_64-linux-gnu) Siege/4.0.4 به صورت پیش فرض به عنوان agent ارسال می شود.
یکی دیگر از هدرهایی که نوع مدیای درون بدنه درخواست را تعیین می کند، هدرcontent-type است. ابزار Siege برای این هدر یک سوئیچ مجزا با نام T- یا content-type-- در نظر گرفته است. تست باید با سوئیچ g- انجام شود تا هدر درخواست و هدر پاسخ قابل مشاهده باشد.</p>
<div class="highlight"><pre><span></span><code>siege -c <span class="m">1</span> -t 5S -g -v --header<span class="o">=</span><span class="s2">&quot;content-type:application/json&quot;</span> http://localhost:8001/
</code></pre></div>

<p>خروجی تست :</p>
<div class="highlight"><pre><span></span><code>HEAD / HTTP/1.0
Host: localhost:8001
Accept: /
Accept-Encoding: gzip, deflate
User-Agent: Mozilla/5.0 <span class="o">(</span>pc-x86_64-linux-gnu<span class="o">)</span> Siege/4.0.4
content-type: application/json
Connection: close

HTTP/1.0 <span class="m">200</span> OK
Server: SimpleHTTP/0.6 Python/3.6.8
Date: Wed, <span class="m">10</span> Jul <span class="m">2019</span> <span class="m">16</span>:34:29 GMT
Content-type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
Content-Length: <span class="m">418</span>
</code></pre></div>

<p><strong>Siege برای حملات DOS</strong></p>
<p>ابزار siege برای حملات  DOS نیز استفاده می‌شود. و اگر این حملات به صورت توزیع شده باشد،‌ حمله اصطلاحا <a href="https://en.wikipedia.org/wiki/Denial-of-service_attack#Distributed_attack">DDOS</a> خواهد بود. برای جلوگیری از متهم شدن به حمله DOS تمام تست های این بخش بر روی سرور محلی انجام می‌شود. مانند مثال های قبل سرور محلی را با دستور زیر ایجاد می کنیم.</p>
<div class="highlight"><pre><span></span><code>python -m http.server <span class="m">8001</span> --bind<span class="o">=</span><span class="m">127</span>.0.0.1
</code></pre></div>

<p>پس از اجرای سرور،‌ تست را انجام می دهیم.</p>
<div class="highlight"><pre><span></span><code>siege -c <span class="m">255</span> -r <span class="m">10</span> -v -b http://localhost:8001/
</code></pre></div>

<p>سوئیچ b- تاخیر بین درخواست ها را از بین می‌برد و از این طریق حمله موثرتر انجام خواهد شد!
البته به صورت پیش فرض تعداد کاربران شبیه سازی شده‌ی محدودی را می توانید استفاده کنید. این محدودیت را می تونید با باز کردن فایل کانفیگ siege یا فایل siegerc ببینید.(محدودیت در متغیر limit اعمال شده است) این نکته را هم باید مد نظر داشته باشید که سیستم برای هر درخواست کاربر شبیه سازی شده یک سوکت باز می کند.برای موثر بودن حمله مقدار سوئیچ‌های t- یا r- را تا حد معقولی افزایش دهید. برای جلوگیری از حملات DOS <a href="https://www.indusface.com/blog/top-6-ddos-attack-prevention-tactics-2021/">چندین راه مختلف وجود دارد</a>.</p>
<p><strong>استفاده از Siege برای ارسال دیتای POST</strong></p>
<p>از این قابلیت برای تست API ها استفاده می‌شود ولی با وجود ابزارهای قدرتمندی مانند Postman یا cURL شاید از استفاده از Siege چندان عاقلانه به نظر نرسد.در هر حال این قابلیت در siege وجود دارد. برای ارسال دیتای پست با Siege به صورت زیر عمل می کنیم:</p>
<div class="highlight"><pre><span></span><code>siege -c <span class="m">1</span> -r <span class="m">1</span> -v <span class="s1">&#39;http://sample.com/ POST foo=bar&amp;baz=bash&#39;</span>
</code></pre></div>

<p>این دستور با یک کاربر شبیه سازی شده و تعداد تکرار یک، به آدرس فرضی sample.com دیتاهای foo=bar و baz=bash را ارسال می کند.</p>
<p><strong>مروری بر مهم‌ترین کانفیگ‌های Siege</strong></p>
<p>همان‌طور که قبلا اشاره شد کانفیگ ابزار در مسیر <code>etc/siege/siegerc/</code> قرار دارد. البته یک کپی از تنظیمات نیز در مسیر ‍<code>siege/siege.cong./~</code> وجود دارد. توضیحات مربوط به هر کانفیگ در قسمت بالای آن کانفیگ به صورت کامنت‌شده قرار دارد در این قسمت چند کانفیگ مهم را مرور خواهیم کرد.</p>
<p>درباره‌ی log در ابزار قبلا توضیح دادیم. <code>logfile</code> مسیر لاگ‌های ابزار را مشخص می‌کند. <code>verbose</code> همان سوئیچ v- است. <code>color</code> برای نمایش خروجی به صورت رنگی استفاده می‌شود و مقادیر آن به صورت on/off می‌باشد. <code>quiet</code> همان سوئیچ q- است. قبلا ذکر شد که اگر ابزار با سوئیچ g- اجرا شود، هدر درخواست و پاسخ نمایش داده می‌شود. تنظیم <code>gmethod</code> متدی را که ابزار در حالتی که با سوئیچ g- اجرا می‌شود را تعیین می کند. مقادیر این تنظیم GET/HEAD هستند. با متد HEAD فقط هدر درخواست و پاسخ نمایش داده می‌شود اما با متد GET تمام صفحه‌ای که درخواست به آن ارسال می‌شود، برگشت داده می‌شود و این دقیقا همان کاری‌ است که سوئیچ p- انجام می‌دهد. وقتی که درخواستی به یک سرور ارسال می‌شوداگر آپشن v- استفاده شده باشد، لاگ های ابزار در خروجی قرار می گیرند همچنین آدرس‌هایی که تست می‌شوند به صورت خلاصه شده در لاگ خروجی قرار می گیرند. با <code>fullurl</code> می توانیم خروجی لاگ‌ها را به صورت کامل نمایش دهیم. مقادیر این تنظیم به صورت true/false است. <code>protocol</code> پروتکل درخواست را مشخص می کند مقادیر آن می تواند HTTP/1.0 یا HTTP/1.1 باشد. در مورد HTTP/2.0 در مستندات اشاره‌ای نشده است. <code>concurrent</code> مشابه سوئیچ c- است. برای بعضی از تنظیمات،‌ سوئیچ‌های متناظری نیز در نظر گرفته شده است. تنظیم‌های <code>time</code> و <code>reps</code> و <code>file</code> و <code>dely</code> و <code>internet</code> و <code>benchmark</code> و سوئیچ‌های t- و ‍r- و f- و d- و i- و b- متناظر هستند.</p>
		</div>
	</div>
</div>
		</div>
		<div class="push"></div>
	</div>
	<div class="footer">
		<div class="container">
			<hr/>
				<ul class="nav nav-pills pull-right">
				  <li><a href="/archives.html">بایگانی</a></li>
				  <li><a href="/feeds/all.atom.xml">خبرخوان</a> </li>
				  <li><a href="https://creativecommons.org/licenses/by-sa/2.0/">CC BY-SA 2.0</a> </li>
				</ul>
		</div>
	</div>
</body>
</html>